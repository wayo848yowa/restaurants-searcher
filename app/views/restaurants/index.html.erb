<% content_for :title, "レストラン検索" %>

<div class="container">
  <div class="header">
    <h1>🍽️ レストラン検索</h1>
    <p>現在地から近くのレストランを探します</p>
  </div>
  
  <div class="search-card">
    <%= form_with url: restaurants_path, method: :get, local: true, class: "search-form", id: "restaurant-search-form" do |f| %>
      <div class="form-group">
        <label>📍 現在地情報</label>
        <div class="location-info">
          <div id="location-status">位置情報を取得中...</div>
          <div id="location-coords" style="display:none;"></div>
        </div>
        <%= f.hidden_field :lat, id: "lat-input" %>
        <%= f.hidden_field :lng, id: "lng-input" %>
      </div>
      
      <div class="form-group">
        <label>🔍 検索範囲を選択</label>
        <div class="range-selector">
          <% [
            { value: 1, label: "300m以内" },
            { value: 2, label: "500m以内" },
            { value: 3, label: "1km以内" },
            { value: 4, label: "2km以内" },
            { value: 5, label: "3km以内" }
          ].each do |range_option| %>
            <div class="range-option">
              <%= f.radio_button :range, range_option[:value], 
                    id: "range#{range_option[:value]}", 
                    checked: (@search_params[:range].to_i == range_option[:value]) || (range_option[:value] == 3 && !@search_params[:range]) %>
              <%= f.label "range#{range_option[:value]}", range_option[:label] %>
            </div>
          <% end %>
        </div>
      </div>
      
      <%= f.submit "検索する", class: "btn", id: "search-btn", disabled: true %>
    <% end %>
  </div>
  
  <% if @error_message %>
    <div class="error-message">
      <%= @error_message %>
    </div>
  <% end %>
  
  <% if @restaurants.present? || (@search_params[:lat].present? && @search_params[:lng].present?) %>
    <div class="results-section">
      <div class="results-header">
        <h2>
          検索結果
          <% if @total_count %>
            (<%= @total_count %>件)
          <% end %>
        </h2>
        <% if @search_params[:lat].present? && @search_params[:lng].present? %>
          <p>位置: <%= @search_params[:lat] %>, <%= @search_params[:lng] %></p>
        <% end %>
      </div>
      
      <div class="results-content">
        <% if @restaurants.present? %>
          <div class="restaurant-grid">
            <% @restaurants.each do |restaurant| %>
              <div class="restaurant-card">
                <% if restaurant[:photo] %>
                  <%= image_tag restaurant[:photo], alt: restaurant[:name], class: "restaurant-image" %>
                <% else %>
                  <div class="restaurant-image-placeholder">
                    <span>No Image</span>
                  </div>
                <% end %>
                
                <div class="restaurant-info">
                  <h3 class="restaurant-name"><%= restaurant[:name] %></h3>
                  
                  <div class="restaurant-detail">
                    <i>📍</i>
                    <span><%= restaurant[:address] %></span>
                  </div>
                  
                  <% if restaurant[:access] %>
                    <div class="restaurant-detail">
                      <i>🚶</i>
                      <span><%= restaurant[:access] %></span>
                    </div>
                  <% end %>
                  
                  <% if restaurant[:budget] %>
                    <div class="restaurant-detail">
                      <i>💰</i>
                      <span><%= restaurant[:budget] %></span>
                    </div>
                  <% end %>
                  
                  <% if restaurant[:genre] %>
                    <span class="genre-tag"><%= restaurant[:genre] %></span>
                  <% end %>
                  
                  <% if restaurant[:urls] %>
                    <div style="margin-top: 10px;">
                      <%= link_to "詳細を見る", restaurant[:urls], target: "_blank", class: "btn btn-small" %>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="no-results">
            <p>該当するレストランが見つかりませんでした。</p>
            <p>検索範囲を広げてみてください。</p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<%= javascript_include_tag 'restaurant' %>